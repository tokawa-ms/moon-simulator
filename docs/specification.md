# 月の満ち欠けシミュレーター - 仕様書

## 概要

小学校理科教材として、太陽・地球・月の位置関係と月の満ち欠けを可視化する3D教育アプリケーション。

## 技術スタック

- **HTML5**: セマンティックなマークアップ（UTF-8エンコーディング）
- **CSS3**: Tailwind CSS（CDN経由）によるレスポンシブデザイン
- **JavaScript**: ES6準拠、Three.js（r128）を使用した3D可視化
- **実行環境**: ローカルPCのブラウザで直接実行可能（ビルド不要）

## 機能仕様

### 1. メインビュー（3D空間表示）

**目的**: 太陽・地球・月の位置関係を宇宙から俯瞰的に観察

**実装内容**:
- Three.jsによる3Dシーン
- 太陽（黄色、発光）、地球（青色）、月（灰色）を球体で表現
- 地球と月の軌道線を表示
- マウス操作によるカメラコントロール
  - ドラッグで視点回転
  - ホイールでズーム

**天体パラメータ**:
- 太陽半径: 3単位
- 地球半径: 1単位
- 月半径: 0.27単位
- 地球から太陽までの距離: 15単位（固定）
- 月の公転半径: 8単位
- 月の公転周期: 29.5日

### 2. サブビュー1: 地球から見た月

**目的**: 地球の観測者視点での月の見え方を表示

**実装内容**:
- 独立した3Dシーンに月のみを配置
- 太陽光の方向に基づいた照明計算
- 月の公転位置に応じて光の当たり方が変化

### 3. サブビュー2: 月から見た地球

**目的**: 月から地球を見た際の地球の見え方を表示

**実装内容**:
- 独立した3Dシーンに地球のみを配置
- 太陽光の方向に基づいた照明計算
- 月の公転位置に応じて地球の見え方が変化

### 4. サブビュー3: 日本から見た月の形

**目的**: 地球上の特定地点（日本）から観測した月の形を正確に表示

**実装内容**:
- より詳細な月の表現（高解像度球体）
- 月の満ち欠けの名称表示
  - 新月、三日月、上弦の月、十日夜の月
  - 満月、寝待月、下弦の月、有明月
- 公転角度と自転時刻に基づく正確な照明計算

### 5. タイムコントロール

**月の公転スライダー**:
- 範囲: 0〜29.5日
- 刻み: 0.1日
- 機能: 月の軌道上の位置を制御

**地球の自転スライダー**:
- 範囲: 0〜24時間
- 刻み: 0.5時間
- 機能: 地球の自転角度を制御

**再生/停止ボタン**:
- 自動アニメーション機能
- 100msごとに0.1日ずつ進行
- 29.5日到達後、0日に戻る

**リセットボタン**:
- 全パラメータを初期値に戻す
- 月の公転: 0日
- 地球の自転: 12時

## UI/UXデザイン

### レイアウト

```
+------------------------------------------+
|           ヘッダー                        |
+------------------------------------------+
|                    |  地球から見た月      |
|   メインビュー      +---------------------+
|   (3D空間)        |  月から見た地球      |
|                    +---------------------+
|                    |  日本から見た月      |
|                    +---------------------+
|                    |  タイムスライダー    |
|                    +---------------------+
|                    |  使い方説明         |
+------------------------------------------+
```

### レスポンシブ対応

- **デスクトップ**: 横並びレイアウト
- **モバイル**: 縦並びレイアウト
- ビューポート設定により全デバイスで最適表示

### カラースキーム

- 背景: ダークグレー（#111827）
- パネル: グレー（#1F2937）
- アクセント: ブルー（#3B82F6）、グリーン（#10B981）
- テキスト: ホワイト、グレー

## デバッグ機能

### コンソールログ

アプリケーションの動作状況を詳細に出力:

- 初期化プロセスの各ステップ
- 天体オブジェクトの作成と位置
- スライダー操作時のパラメータ変更
- アニメーションの開始/停止
- エラー発生時の詳細情報

**ログレベル**:
- `console.log`: 通常の情報
- `console.error`: エラー情報

## 物理モデル

### 簡略化された天体モデル

教育目的のため、以下の簡略化を実施:

1. **スケール**: 実際の天体サイズ・距離比は非現実的なため、視覚的にわかりやすい比率に調整
2. **軌道**: 円軌道を仮定（実際は楕円軌道）
3. **傾き**: 軌道傾斜角を無視（平面的な表現）
4. **自転**: 地球の自転のみ考慮、月と太陽の自転は省略

### 照明モデル

- 太陽を点光源として扱う
- Phongシェーディングによる光の反射計算
- 環境光により完全な影を避け視認性を確保

## ファイル構成

```
src/
├── index.html          # メインHTMLファイル
├── css/
│   └── styles.css      # カスタムCSSスタイル
└── js/
    └── script.js       # メインJavaScriptロジック
```

## 使用方法

1. ブラウザで `src/index.html` を開く
2. メインビューでマウス操作により視点を調整
3. スライダーで月の公転位置と地球の自転を操作
4. 各サブビューで異なる視点からの見え方を確認
5. 再生ボタンで自動アニメーション

## 教育的価値

このシミュレーターは以下の学習目標をサポート:

1. **空間認識**: 3次元空間での天体配置の理解
2. **因果関係**: 月の位置と見え方の関係性の把握
3. **周期性**: 月の満ち欠けの周期的な変化の観察
4. **視点の転換**: 異なる視点からの観測体験

## 拡張可能性

将来的な機能追加の可能性:

- テクスチャマッピング（実際の天体画像）
- 日食・月食のシミュレーション
- 他の観測地点の追加
- 時刻による星空の変化
- 惑星の追加
- VR対応

## ブラウザ要件

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

WebGL対応が必須。

## パフォーマンス

- 4つの独立した3Dシーンを同時レンダリング
- 60FPS目標
- モダンなGPUを推奨

## ライセンス

MIT License

---

**作成日**: 2026年1月22日
**バージョン**: 1.0.0
**対象学年**: 小学校高学年（理科）
